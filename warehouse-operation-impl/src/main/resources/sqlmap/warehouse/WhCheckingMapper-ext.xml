<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
        "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">


<mapper namespace="com.baozun.scm.primservice.whoperation.dao.warehouse.WhCheckingDao">
    <resultMap id="WhCheckingResultExt" type="com.baozun.scm.primservice.whoperation.model.warehouse.WhChecking">
    </resultMap>

    <resultMap id="WhCheckingCommand" type="com.baozun.scm.primservice.whoperation.command.warehouse.WhCheckingCommand">
    </resultMap>

    <resultMap id="WeightingCommand" type="com.baozun.scm.primservice.whoperation.command.warehouse.WeightingCommand">
    </resultMap>

    <!-- 用于select查询公用抽取的列 -->
    <sql id="whCheckingColumnsExt">
        <![CDATA[
                id as id,
                facility_id as facilityId,
                container_id as containerId,
                batch as batch,
                wave_code as waveCode,
                customer_code as customerCode,
                customer_name as customerName,
                store_code as storeCode,
                store_name as storeName,
                transport_code as transportCode,
                transport_name as transportName,
                product_code as productCode,
                product_name as productName,
                time_effect_code as timeEffectCode,
                time_effect_name as timeEffectName,
                status as status,
                ou_id as ouId,
                outer_container_id as outerContainerId,
                container_lattice_no as containerLatticeNo,
                outboundbox_id as outboundboxId,
                outboundbox_code as outboundboxCode,
                distribution_mode as distributionMode,
                picking_mode as pickingMode,
                checking_mode as checkingMode
        ]]>
    </sql>

    <sql id="whCheckWeightingExt">
        <![CDATA[
                ch.id as id,
                ch.facility_id as facilityId,
                ch.container_id as containerId,
                ch.batch as batch,
                ch.wave_code as waveCode,
                ch.customer_code as customerCode,
                ch.customer_name as customerName,
                ch.store_code as storeCode,
                ch.store_name as storeName,
                ch.transport_code as transportCode,
                ch.transport_name as transportName,
                ch.product_code as productCode,
                ch.product_name as productName,
                ch.time_effect_code as timeEffectCode,
                ch.time_effect_name as timeEffectName,
                ch.status as status,
                ch.ou_id as ouId,
                ch.outer_container_id as outerContainerId,
                ch.container_lattice_no as containerLatticeNo,
                ch.outboundbox_id as outboundboxId,
                ch.outboundbox_code as outboundboxCode,
                ch.distribution_mode as distributionMode,
                ch.picking_mode as pickingMode,
                ch.checking_mode as checkingMode
        ]]>
    </sql>

    <sql id="whCheckingDynamicWhereExt">
        <!-- ognl访问静态方法的表达式 为@class@method(args),以下为调用rapid中的Ognl.isNotEmpty()方法,还有其它方法如isNotBlank()可以使用，具体请查看Ognl类 -->
        <where>

            <if test="id!=null">
                and id = #{id}
            </if>

            <if test="facilityId!=null">
                and facility_id = #{facilityId}
            </if>

            <if test="containerId!=null">
                and container_id = #{containerId}
            </if>


            <if test="batch!=null and batch!=''">
                and batch = #{batch}
            </if>


            <if test="waveCode!=null and waveCode!=''">
                and wave_code = #{waveCode}
            </if>


            <if test="customerCode!=null and customerCode!=''">
                and customer_code = #{customerCode}
            </if>


            <if test="customerName!=null and customerName!=''">
                and customer_name = #{customerName}
            </if>


            <if test="storeCode!=null and storeCode!=''">
                and store_code = #{storeCode}
            </if>


            <if test="storeName!=null and storeName!=''">
                and store_name = #{storeName}
            </if>


            <if test="transportCode!=null and transportCode!=''">
                and transport_code = #{transportCode}
            </if>


            <if test="transportName!=null and transportName!=''">
                and transport_name = #{transportName}
            </if>


            <if test="productCode!=null and productCode!=''">
                and product_code = #{productCode}
            </if>


            <if test="productName!=null and productName!=''">
                and product_name = #{productName}
            </if>


            <if test="timeEffectCode!=null and timeEffectCode!=''">
                and time_effect_code = #{timeEffectCode}
            </if>


            <if test="timeEffectName!=null and timeEffectName!=''">
                and time_effect_name = #{timeEffectName}
            </if>

            <if test="status!=null">
                and status = #{status}
            </if>

            <if test="ouId!=null">
                and ou_id = #{ouId}
            </if>

            <if test="outerContainerId!=null">
                and outer_container_id = #{outerContainerId}
            </if>

            <if test="containerLatticeNo!=null">
                and container_lattice_no = #{containerLatticeNo}
            </if>

            <if test="outboundboxId!=null">
                and outboundbox_id = #{outboundboxId}
            </if>


            <if test="outboundboxCode!=null and outboundboxCode!=''">
                and outboundbox_code = #{outboundboxCode}
            </if>


            <if test="distributionMode!=null and distributionMode!=''">
                and distribution_mode = #{distributionMode}
            </if>


            <if test="pickingMode!=null and pickingMode!=''">
                and picking_mode = #{pickingMode}
            </if>


            <if test="checkingMode!=null and checkingMode!=''">
                and checking_mode = #{checkingMode}
            </if>
        </where>
    </sql>
    
    
     <select id="findByWaybillCode" resultMap="WeightingCommand" flushCache="false">
        select
        <include refid="whCheckWeightingExt"/>
        from t_wh_checking ch left join t_wh_odo_delivery_info info on ch.outboundbox_code = info.outboundbox_code
		where info.waybill_code = #{waybillCode} and ch.ou_id = #{ouId}
    </select>

     <select id="findByOutboundBoxCode" resultMap="WeightingCommand" flushCache="false">
        select
        <include refid="whCheckWeightingExt"/>
        from t_wh_checking ch 
		where ch.outboundbox_code = #{outboundBoxCode} and ch.ou_id = #{ouId}
    </select>
    

</mapper>
