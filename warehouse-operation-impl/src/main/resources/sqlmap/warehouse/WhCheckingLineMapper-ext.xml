<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
        "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">


<mapper namespace="com.baozun.scm.primservice.whoperation.dao.warehouse.WhCheckingLineDao">
    <resultMap id="WhCheckingLineResultExt" type="com.baozun.scm.primservice.whoperation.model.warehouse.WhCheckingLine">
    </resultMap>

    <resultMap id="WhCheckingLineCommand" type="com.baozun.scm.primservice.whoperation.command.warehouse.WhCheckingLineCommand">
    </resultMap>

    <!-- 用于select查询公用抽取的列 -->
    <sql id="whCheckingLineColumnsExt">
        <![CDATA[
                id as id,
                checking_id as checkingId,
                sku_code as skuCode,
                sku_ext_code as skuExtCode,
                sku_bar_code as skuBarCode,
                sku_name as skuName,
                qty as qty,
                checking_qty as checkingQty,
                customer_code as customerCode,
                customer_name as customerName,
                store_code as storeCode,
                store_name as storeName,
                inv_status as invStatus,
                inv_type as invType,
                batch_number as batchNumber,
                mfg_date as mfgDate,
                exp_date as expDate,
                country_of_origin as countryOfOrigin,
                inv_attr1 as invAttr1,
                inv_attr2 as invAttr2,
                inv_attr3 as invAttr3,
                inv_attr4 as invAttr4,
                inv_attr5 as invAttr5,
                uuid as uuid,
                ou_id as ouId,
                odo_id as odoId,
                odo_line_id as odoLineId,
                create_id as createId,
                create_time as createTime,
	        	last_modify_time as lastModifyTime,
	        	modified_id as modifiedId,
	        	outboundbox_id as outboundboxId,
	        	outboundbox_code as outboundboxCode
        ]]>
    </sql>

    <sql id="whCheckingLineDynamicWhereExt">
        <!-- ognl访问静态方法的表达式 为@class@method(args),以下为调用rapid中的Ognl.isNotEmpty()方法,还有其它方法如isNotBlank()可以使用，具体请查看Ognl类 -->
        <where>

            <if test="id!=null">
                and id = #{id}
            </if>

            <if test="checkingId!=null">
                and checking_id = #{checkingId}
            </if>


            <if test="skuCode!=null and skuCode!=''">
                and sku_code = #{skuCode}
            </if>


            <if test="skuExtCode!=null and skuExtCode!=''">
                and sku_ext_code = #{skuExtCode}
            </if>


            <if test="skuBarCode!=null and skuBarCode!=''">
                and sku_bar_code = #{skuBarCode}
            </if>


            <if test="skuName!=null and skuName!=''">
                and sku_name = #{skuName}
            </if>

            <if test="qty!=null">
                and qty = #{qty}
            </if>

            <if test="checkingQty!=null">
                and checking_qty = #{checkingQty}
            </if>


            <if test="customerCode!=null and customerCode!=''">
                and customer_code = #{customerCode}
            </if>


            <if test="customerName!=null and customerName!=''">
                and customer_name = #{customerName}
            </if>


            <if test="storeCode!=null and storeCode!=''">
                and store_code = #{storeCode}
            </if>


            <if test="storeName!=null and storeName!=''">
                and store_name = #{storeName}
            </if>


            <if test="invStatus!=null and invStatus!=''">
                and inv_status = #{invStatus}
            </if>


            <if test="invType!=null and invType!=''">
                and inv_type = #{invType}
            </if>


            <if test="batchNumber!=null and batchNumber!=''">
                and batch_number = #{batchNumber}
            </if>

            <if test="mfgDate!=null">
                and mfg_date = #{mfgDate}
            </if>

            <if test="expDate!=null">
                and exp_date = #{expDate}
            </if>


            <if test="countryOfOrigin!=null and countryOfOrigin!=''">
                and country_of_origin = #{countryOfOrigin}
            </if>


            <if test="invAttr1!=null and invAttr1!=''">
                and inv_attr1 = #{invAttr1}
            </if>


            <if test="invAttr2!=null and invAttr2!=''">
                and inv_attr2 = #{invAttr2}
            </if>


            <if test="invAttr3!=null and invAttr3!=''">
                and inv_attr3 = #{invAttr3}
            </if>


            <if test="invAttr4!=null and invAttr4!=''">
                and inv_attr4 = #{invAttr4}
            </if>


            <if test="invAttr5!=null and invAttr5!=''">
                and inv_attr5 = #{invAttr5}
            </if>


            <if test="uuid!=null and uuid!=''">
                and uuid = #{uuid}
            </if>

            <if test="ouId!=null">
                and ou_id = #{ouId}
            </if>

            <if test="odoId!=null">
                and odo_id = #{odoId}
            </if>

            <if test="odoLineId!=null">
                and odo_line_id = #{odoLineId}
            </if>
            
            <if test="createTime!=null">
					and create_time = #{createTime}
				</if>
	       
				<if test="lastModifyTime!=null">
					and last_modify_time = #{lastModifyTime}
				</if>
	       
				<if test="createId!=null">
					and create_id = #{createId}
				</if>
	       
				<if test="modifiedId!=null">
					and modified_id = #{modifiedId}
				</if>
				
				<if test="outboundboxId!=null">
					and outboundbox_id = #{outboundboxId}
				</if>
				
				<if test="outboundboxCode!=null and outboundboxCode!=''">
                and outboundbox_code = #{outboundboxCode}
            </if>
        </where>
    </sql>

    <select id="getCheckingLineByCheckingId" resultMap="WhCheckingLineCommand">
        select
        <include refid="whCheckingLineColumnsExt" />
        from
        t_wh_checking_line
        <where>
            ou_id = #{ouId}
            <if test="checkingId!=null">
                and checking_id = #{checkingId}
            </if>
        </where>
    </select>

    <update id="updateByVersion" parameterType="com.baozun.scm.primservice.whoperation.model.warehouse.WhCheckingLine">
        <![CDATA[
            UPDATE t_wh_checking_line SET
                checking_id = #{checkingId,javaType=java.lang.Long,jdbcType=BIGINT} ,
                sku_code = #{skuCode,javaType=java.lang.String,jdbcType=VARCHAR} ,
                sku_ext_code = #{skuExtCode,javaType=java.lang.String,jdbcType=VARCHAR} ,
                sku_bar_code = #{skuBarCode,javaType=java.lang.String,jdbcType=VARCHAR} ,
                sku_name = #{skuName,javaType=java.lang.String,jdbcType=VARCHAR} ,
                qty = #{qty,javaType=Long,jdbcType=DECIMAL} ,
                checking_qty = #{checkingQty,javaType=Long,jdbcType=DECIMAL} ,
                customer_code = #{customerCode,javaType=java.lang.String,jdbcType=VARCHAR} ,
                customer_name = #{customerName,javaType=java.lang.String,jdbcType=VARCHAR} ,
                store_code = #{storeCode,javaType=java.lang.String,jdbcType=VARCHAR} ,
                store_name = #{storeName,javaType=java.lang.String,jdbcType=VARCHAR} ,
                inv_status = #{invStatus,javaType=java.lang.String,jdbcType=VARCHAR} ,
                inv_type = #{invType,javaType=java.lang.String,jdbcType=VARCHAR} ,
                batch_number = #{batchNumber,javaType=java.lang.String,jdbcType=VARCHAR} ,
                mfg_date = #{mfgDate,javaType=java.util.Date,jdbcType=TIMESTAMP} ,
                exp_date = #{expDate,javaType=java.util.Date,jdbcType=TIMESTAMP} ,
                country_of_origin = #{countryOfOrigin,javaType=java.lang.String,jdbcType=VARCHAR} ,
                inv_attr1 = #{invAttr1,javaType=java.lang.String,jdbcType=VARCHAR} ,
                inv_attr2 = #{invAttr2,javaType=java.lang.String,jdbcType=VARCHAR} ,
                inv_attr3 = #{invAttr3,javaType=java.lang.String,jdbcType=VARCHAR} ,
                inv_attr4 = #{invAttr4,javaType=java.lang.String,jdbcType=VARCHAR} ,
                inv_attr5 = #{invAttr5,javaType=java.lang.String,jdbcType=VARCHAR} ,
                uuid = #{uuid,javaType=java.lang.String,jdbcType=VARCHAR} ,
                odo_id = #{odoId,javaType=java.lang.Long,jdbcType=BIGINT} ,
                odo_line_id = #{odoLineId,javaType=java.lang.Long,jdbcType=BIGINT} ,
                create_id = #{createId,javaType=java.lang.Long,jdbcType=BIGINT} , 
                create_time = #{createTime,javaType=java.util.Date,jdbcType=TIMESTAMP} , 
		        last_modify_time = now(),
		        modified_id = #{modifiedId,javaType=java.lang.Long,jdbcType=BIGINT} ,
		        outboundbox_id = #{outboundboxId,javaType=java.lang.Long,jdbcType=BIGINT} ,
		        outboundbox_code = #{outboundboxCode,javaType=java.lang.Long,jdbcType=BIGINT} 
            WHERE 
                id = #{id}  and ou_id = #{ouId}
                and last_modify_time	=  #{lastModifyTime}  
        ]]>
    </update>
    
    <sql id="whCheckingLineCommandColumnsExt">
        <![CDATA[
                line.id as id,
                line.checking_id as checkingId,
                line.sku_code as skuCode,
                line.sku_ext_code as skuExtCode,
                line.sku_bar_code as skuBarCode,
                line.sku_name as skuName,
                line.qty as qty,
                line.checking_qty as checkingQty,
                line.customer_code as customerCode,
                line.customer_name as customerName,
                line.store_code as storeCode,
                line.store_name as storeName,
                line.inv_status as invStatus,
                line.inv_type as invType,
                line.batch_number as batchNumber,
                line.mfg_date as mfgDate,
                line.exp_date as expDate,
                line.country_of_origin as countryOfOrigin,
                line.inv_attr1 as invAttr1,
                line.inv_attr2 as invAttr2,
                line.inv_attr3 as invAttr3,
                line.inv_attr4 as invAttr4,
                line.inv_attr5 as invAttr5,
                line.uuid as uuid,
                line.ou_id as ouId,
                line.odo_id as odoId,
                line.odo_line_id as odoLineId,
                status.name as invStatusStr,
                odo.odo_code as odoCode
        ]]>
    </sql>
    
    <select id="findListByParamExt" resultMap="WhCheckingLineCommand">
        select
        <include refid="whCheckingLineCommandColumnsExt"/>
        from t_wh_checking_line line left join t_wh_inventory_status status on line.inv_status = status.id
        left join t_wh_odo odo on line.odo_id = odo.id
        <include refid="whCheckingLineCommandDynamicWhereExt"/>

    </select>
    
    <sql id="whCheckingLineCommandDynamicWhereExt">
        <!-- ognl访问静态方法的表达式 为@class@method(args),以下为调用rapid中的Ognl.isNotEmpty()方法,还有其它方法如isNotBlank()可以使用，具体请查看Ognl类 -->
        <where>

            <if test="id!=null">
                and line.id = #{id}
            </if>

            <if test="checkingId!=null">
                and line.checking_id = #{checkingId}
            </if>


            <if test="skuCode!=null and skuCode!=''">
                and line.sku_code = #{skuCode}
            </if>


            <if test="skuExtCode!=null and skuExtCode!=''">
                and line.sku_ext_code = #{skuExtCode}
            </if>


            <if test="skuBarCode!=null and skuBarCode!=''">
                and line.sku_bar_code = #{skuBarCode}
            </if>


            <if test="skuName!=null and skuName!=''">
                and line.sku_name = #{skuName}
            </if>

            <if test="qty!=null">
                and line.qty = #{qty}
            </if>

            <if test="checkingQty!=null">
                and line.checking_qty = #{checkingQty}
            </if>


            <if test="customerCode!=null and customerCode!=''">
                and line.customer_code = #{customerCode}
            </if>


            <if test="customerName!=null and customerName!=''">
                and line.customer_name = #{customerName}
            </if>


            <if test="storeCode!=null and storeCode!=''">
                and line.store_code = #{storeCode}
            </if>


            <if test="storeName!=null and storeName!=''">
                and line.store_name = #{storeName}
            </if>


            <if test="invStatus!=null and invStatus!=''">
                and line.inv_status = #{invStatus}
            </if>


            <if test="invType!=null and invType!=''">
                and line.inv_type = #{invType}
            </if>


            <if test="batchNumber!=null and batchNumber!=''">
                and line.batch_number = #{batchNumber}
            </if>

            <if test="mfgDate!=null">
                and line.mfg_date = #{mfgDate}
            </if>

            <if test="expDate!=null">
                and line.exp_date = #{expDate}
            </if>


            <if test="countryOfOrigin!=null and countryOfOrigin!=''">
                and line.country_of_origin = #{countryOfOrigin}
            </if>


            <if test="invAttr1!=null and invAttr1!=''">
                and line.inv_attr1 = #{invAttr1}
            </if>


            <if test="invAttr2!=null and invAttr2!=''">
                and line.inv_attr2 = #{invAttr2}
            </if>


            <if test="invAttr3!=null and invAttr3!=''">
                and line.inv_attr3 = #{invAttr3}
            </if>


            <if test="invAttr4!=null and invAttr4!=''">
                and line.inv_attr4 = #{invAttr4}
            </if>


            <if test="invAttr5!=null and invAttr5!=''">
                and line.inv_attr5 = #{invAttr5}
            </if>


            <if test="uuid!=null and uuid!=''">
                and line.uuid = #{uuid}
            </if>

            <if test="ouId!=null">
                and line.ou_id = #{ouId}
            </if>

            <if test="odoId!=null">
                and line.odo_id = #{odoId}
            </if>

            <if test="odoLineId!=null">
                and line.odo_line_id = #{odoLineId}
            </if>
        </where>
    </sql>
    
    
       <select id="findCheckingLineById" resultMap="WhCheckingLineCommand">
        select
        <include refid="whCheckingLineColumnsExt"/>
        from t_wh_checking_line
        where id = #{id}
              and ou_id = #{ouId}

    </select>
    
    
     <select id="judeIsLastBox" resultMap="WhCheckingLineCommand">
        select
            sum(qty) as qty,
            sum(checking_qty) as checkingQty
        from t_wh_checking_line
        where ou_id = #{ouId}
              and odo_id = #{odoId}

    </select>
    
</mapper>
