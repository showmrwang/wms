<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">


<mapper namespace="com.baozun.scm.primservice.whoperation.dao.odo.wave.WhWaveLineDao">
	<resultMap id="WhWaveLineResultExt" type="com.baozun.scm.primservice.whoperation.model.odo.wave.WhWaveLine">
	</resultMap>
	<resultMap id="WhWaveLineCommandResultExt" type="com.baozun.scm.primservice.whoperation.command.wave.WaveLineCommand">
	</resultMap>

    <resultMap id="WhWaveLineCommand" type="com.baozun.scm.primservice.whoperation.command.wave.WhWaveLineCommand">
    </resultMap>
	
	<resultMap id="WaveLineSku"
		type="com.baozun.scm.primservice.whoperation.command.odo.wave.SoftAllocationCommand">
		<id column="waveLineId" property="lineId" />
		<result column="skuId" property="skuId" />
		<result column="ouId1" property="ouId" />
		<result column="qtys1" property="qtys" />
		<result column="sQtys1" property="sQtys" />
		<association property="whWaveLine" javaType="com.baozun.scm.primservice.whoperation.model.odo.wave.WhWaveLine">
			<id column="waveLineId" property="id" />
			<result column="waveLineWaveId" property="waveId" />
			<result column="waveLineOdoLineId" property="odoLineId" />
			<result column="waveLineOdoId" property="odoId" />
			<result column="waveLineOdoCode" property="odoCode" />
			<result column="waveLineOdoPriorityLevel" property="odoPriorityLevel" />
			<result column="waveLineOdoPlanDeliverGoodsTime" property="odoPlanDeliverGoodsTime" />
			<result column="waveLineOdoOrderTime" property="odoOrderTime" />
			<result column="waveLineAllocateRuleId" property="allocateRuleId" />
			<result column="waveLineLinenum" property="linenum" />
			<result column="waveLineStoreId" property="storeId" />
			<result column="waveLineExtLinenum" property="extLinenum" />
			<result column="waveLineSkuId" property="skuId" />
			<result column="waveLineSkuBarCode" property="skuBarCode" />
			<result column="waveLineSkuName" property="skuName" />
			<result column="waveLineExtSkuName" property="extSkuName" />
			<result column="waveLineQty" property="qty" />
			<result column="waveLineIsWholeOrderOutbound" property="isWholeOrderOutbound" />
			<result column="waveLineFullLineOutbound" property="fullLineOutbound" />
			<result column="waveLineMfgDate" property="mfgDate" />
			<result column="waveLineExpDate" property="expDate" />
			<result column="waveLineMinExpDate" property="minExpDate" />
			<result column="waveLineMaxExpDate" property="maxExpDate" />
			<result column="waveLineBatchNumber" property="batchNumber" />
			<result column="waveLineCountryOfOrigin" property="countryOfOrigin" />
			<result column="waveLineInvStatus" property="invStatus" />
			<result column="waveLineInvType" property="invType" />
			<result column="waveLineInvAttr1" property="invAttr1" />
			<result column="waveLineInvAttr2" property="invAttr2" />
			<result column="waveLineInvAttr3" property="invAttr3" />
			<result column="waveLineInvAttr4" property="invAttr4" />
			<result column="waveLineInvAttr5" property="invAttr5" />
			<result column="waveLineOutboundCartonType" property="outboundCartonType" />
			<result column="waveLineColor" property="color" />
			<result column="waveLineStyle" property="style" />
			<result column="waveLineSize" property="size" />
			<result column="waveLineOuId" property="ouId" />
			<result column="waveLineCreateTime" property="createTime" />
			<result column="waveLineCreatedId" property="createdId" />
			<result column="waveLineLastModifyTime" property="lastModifyTime" />
			<result column="waveLineModifiedId" property="modifiedId" />
		</association>
		<association property="sku" javaType="com.baozun.scm.primservice.whoperation.model.sku.Sku">
			<id column="skuSkuId" property="id" />
			<result column="skuCode" property="code" />
			<result column="skuExtCode" property="extCode" />
			<result column="skuBarCode" property="barCode" />
			<result column="skuName" property="name" />
			<result column="skuEnName" property="enName" />
			<result column="skuDescription" property="description" />
			<result column="skuColor" property="color" />
			<result column="skuStyle" property="style" />
			<result column="skuSize" property="size" />
			<result column="skuLength" property="length" />
			<result column="skuWidth" property="width" />
			<result column="skuHeight" property="height" />
			<result column="skuLengthUom" property="lengthUom" />
			<result column="skuVolumeUom" property="volumeUom" />
			<result column="skuWeightUom" property="weightUom" />
			<result column="skuVolume" property="volume" />
			<result column="skuWeight" property="weight" />
			<result column="skuBrandId" property="brandId" />
			<result column="skuCustomerId" property="customerId" />
			<result column="skuOuId" property="ouId" />
			<result column="skuCreateTime" property="createTime" />
			<result column="skuCreatedId" property="createdId" />
			<result column="skuLastModifyTime" property="lastModifyTime" />
			<result column="skuModifiedId" property="modifiedId" />
			<result column="skuLifecycle" property="lifecycle" />
		</association>
		<association property="whOdoLine" javaType="com.baozun.scm.primservice.whoperation.model.odo.WhOdoLine">
			<id column="odoLineId" property="id" />
			<result column="odoLineOdoId" property="odoId" />
			<result column="odoLineLinenum" property="linenum" />
			<result column="odoLineOriginalLinenum" property="originalLinenum" />
			<result column="odoLineStoreId" property="storeId" />
			<result column="odoLineExtLinenum" property="extLinenum" />
			<result column="odoLineSkuId" property="skuId" />
			<result column="odoLineSkuBarCode" property="skuBarCode" />
			<result column="odoLineSkuName" property="skuName" />
			<result column="odoLineExtSkuName" property="extSkuName" />
			<result column="odoLineQty" property="qty" />
			<result column="odoLinePlanQty" property="planQty" />
			<result column="odoLineCurrentQty" property="currentQty" />
			<result column="odoLineActualQty" property="actualQty" />
			<result column="odoLineCancelQty" property="cancelQty" />
			<result column="odoLineAssignQty" property="assignQty" />
			<result column="odoLineDiekingQty" property="diekingQty" />
			<result column="odoLineLinePrice" property="linePrice" />
			<result column="odoLineLineAmt" property="lineAmt" />
			<result column="odoLineOdoLineStatus" property="odoLineStatus" />
			<result column="odoLineIsCheck" property="isCheck" />
			<result column="odoLineFullLineOutbound" property="fullLineOutbound" />
			<result column="odoLinePartOutboundStrategy" property="partOutboundStrategy" />
			<result column="odoLineMfgDate" property="mfgDate" />
			<result column="odoLineExpDate" property="expDate" />
			<result column="odoLineMinExpDate" property="minExpDate" />
			<result column="odoLineMaxExpDate" property="maxExpDate" />
			<result column="odoLineBatchNumber" property="batchNumber" />
			<result column="odoLineCountryOfOrigin" property="countryOfOrigin" />
			<result column="odoLineInvStatus" property="invStatus" />
			<result column="odoLineInvType" property="invType" />
			<result column="odoLineInvAttr1" property="invAttr1" />
			<result column="odoLineInvAttr2" property="invAttr2" />
			<result column="odoLineInvAttr3" property="invAttr3" />
			<result column="odoLineInvAttr4" property="invAttr4" />
			<result column="odoLineInvAttr5" property="invAttr5" />
			<result column="odoLineOutboundCartonType" property="outboundCartonType" />
			<result column="odoLineColor" property="color" />
			<result column="odoLineStyle" property="style" />
			<result column="odoLineSize" property="size" />
			<result column="odoLineMixingAttr" property="mixingAttr" />
			<result column="odoLineOriginalOdoCode" property="originalOdoCode" />
			<result column="odoLineAssignFailReason" property="assignFailReason" />
			<result column="odoLineIsAssignSuccess" property="isAssignSuccess" />
			<result column="odoLineOuId" property="ouId" />
			<result column="odoLineCreateTime" property="createTime" />
			<result column="odoLineCreatedId" property="createdId" />
			<result column="odoLineLastModifyTime" property="lastModifyTime" />
			<result column="odoLineModifiedId" property="modifiedId" />
			<result column="odoLineWaveCode" property="waveCode" />
		</association>
	</resultMap>
	
	<!-- 用于select查询公用抽取的列 -->
	<sql id="whWaveLineColumnsExt">
	    <![CDATA[
	        	id as id,
	        	wave_id as waveId,
	        	odo_line_id as odoLineId,
	        	odo_id as odoId,
	        	odo_code as odoCode,
	        	odo_priority_level as odoPriorityLevel,
	        	odo_plan_deliver_goods_time as odoPlanDeliverGoodsTime,
	        	odo_order_time as odoOrderTime,
	        	allocate_rule_id as allocateRuleId,
	        	linenum as linenum,
	        	store_id as storeId,
	        	ext_linenum as extLinenum,
	        	sku_id as skuId,
	        	sku_bar_code as skuBarCode,
	        	sku_name as skuName,
	        	ext_sku_name as extSkuName,
	        	qty as qty,
	        	allocate_qty as allocateQty,
	        	is_whole_order_outbound as isWholeOrderOutbound,
	        	full_line_outbound as fullLineOutbound,
	        	mfg_date as mfgDate,
	        	exp_date as expDate,
	        	min_exp_date as minExpDate,
	        	max_exp_date as maxExpDate,
	        	batch_number as batchNumber,
	        	country_of_origin as countryOfOrigin,
	        	inv_status as invStatus,
	        	inv_type as invType,
	        	inv_attr1 as invAttr1,
	        	inv_attr2 as invAttr2,
	        	inv_attr3 as invAttr3,
	        	inv_attr4 as invAttr4,
	        	inv_attr5 as invAttr5,
	        	outbound_carton_type as outboundCartonType,
	        	color as color,
	        	style as style,
	        	size as size,
	        	ou_id as ouId,
	        	create_time as createTime,
	        	created_id as createdId,
	        	last_modify_time as lastModifyTime,
	        	modified_id as modifiedId,
	        	is_pallet_container as isPalletContainer,
	        	pallet_container_qty as palletContainerQty, 
	        	is_static_location_allocate as isStaticLocationAllocate,
	        	static_location_ids as staticLocationIds,
	        	area_id as areaId,
	        	tray_ids as trayIds,
				packing_case_ids as packingCaseIds
	    ]]>
	</sql>
	
	<sql id="whWaveLineDynamicWhereExt">
		<!-- ognl访问静态方法的表达式 为@class@method(args),以下为调用rapid中的Ognl.isNotEmpty()方法,还有其它方法如isNotBlank()可以使用，具体请查看Ognl类 -->
		<where>
	       
				<if test="id!=null">
					and id = #{id}
				</if>
	       
				<if test="waveId!=null">
					and wave_id = #{waveId}
				</if>
	       
				<if test="odoLineId!=null">
					and odo_line_id = #{odoLineId}
				</if>
	       
				<if test="odoId!=null">
					and odo_id = #{odoId}
				</if>
	       
	       
		       <if test="odoCode!=null and odoCode!=''">
					and odo_code = #{odoCode}
				</if>
	       
				<if test="odoPriorityLevel!=null">
					and odo_priority_level = #{odoPriorityLevel}
				</if>
	       
				<if test="odoPlanDeliverGoodsTime!=null">
					and odo_plan_deliver_goods_time = #{odoPlanDeliverGoodsTime}
				</if>
	       
				<if test="odoOrderTime!=null">
					and odo_order_time = #{odoOrderTime}
				</if>
	       
				<if test="allocateRuleId!=null">
					and allocate_rule_id = #{allocateRuleId}
				</if>
	       
				<if test="linenum!=null">
					and linenum = #{linenum}
				</if>
	       
				<if test="storeId!=null">
					and store_id = #{storeId}
				</if>
	       
				<if test="extLinenum!=null">
					and ext_linenum = #{extLinenum}
				</if>
	       
				<if test="skuId!=null">
					and sku_id = #{skuId}
				</if>
	       
	       
		       <if test="skuBarCode!=null and skuBarCode!=''">
					and sku_bar_code = #{skuBarCode}
				</if>
	       
	       
		       <if test="skuName!=null and skuName!=''">
					and sku_name = #{skuName}
				</if>
	       
	       
		       <if test="extSkuName!=null and extSkuName!=''">
					and ext_sku_name = #{extSkuName}
				</if>
	       
				<if test="qty!=null">
					and qty = #{qty}
				</if>
	       
				<if test="isWholeOrderOutbound!=null">
					and is_whole_order_outbound = #{isWholeOrderOutbound}
				</if>
	       
				<if test="fullLineOutbound!=null">
					and full_line_outbound = #{fullLineOutbound}
				</if>
	       
				<if test="mfgDate!=null">
					and mfg_date = #{mfgDate}
				</if>
	       
				<if test="expDate!=null">
					and exp_date = #{expDate}
				</if>
	       
				<if test="minExpDate!=null">
					and min_exp_date = #{minExpDate}
				</if>
	       
				<if test="maxExpDate!=null">
					and max_exp_date = #{maxExpDate}
				</if>
	       
	       
		       <if test="batchNumber!=null and batchNumber!=''">
					and batch_number = #{batchNumber}
				</if>
	       
	       
		       <if test="countryOfOrigin!=null and countryOfOrigin!=''">
					and country_of_origin = #{countryOfOrigin}
				</if>
	       
				<if test="invStatus!=null">
					and inv_status = #{invStatus}
				</if>
	       
	       
		       <if test="invType!=null and invType!=''">
					and inv_type = #{invType}
				</if>
	       
	       
		       <if test="invAttr1!=null and invAttr1!=''">
					and inv_attr1 = #{invAttr1}
				</if>
	       
	       
		       <if test="invAttr2!=null and invAttr2!=''">
					and inv_attr2 = #{invAttr2}
				</if>
	       
	       
		       <if test="invAttr3!=null and invAttr3!=''">
					and inv_attr3 = #{invAttr3}
				</if>
	       
	       
		       <if test="invAttr4!=null and invAttr4!=''">
					and inv_attr4 = #{invAttr4}
				</if>
	       
	       
		       <if test="invAttr5!=null and invAttr5!=''">
					and inv_attr5 = #{invAttr5}
				</if>
	       
				<if test="outboundCartonType!=null">
					and outbound_carton_type = #{outboundCartonType}
				</if>
	       
	       
		       <if test="color!=null and color!=''">
					and color = #{color}
				</if>
	       
	       
		       <if test="style!=null and style!=''">
					and style = #{style}
				</if>
	       
	       
		       <if test="size!=null and size!=''">
					and size = #{size}
				</if>
	       
				<if test="ouId!=null">
					and ou_id = #{ouId}
				</if>
	       
				<if test="createTime!=null">
					and create_time = #{createTime}
				</if>
	       
				<if test="createdId!=null">
					and created_id = #{createdId}
				</if>
	       
				<if test="lastModifyTime!=null">
					and last_modify_time = #{lastModifyTime}
				</if>
	       
				<if test="modifiedId!=null">
					and modified_id = #{modifiedId}
				</if>
				
				<if test="isPalletContainer!=null">
		        	and is_pallet_container = #{isPalletContainer}
		        </if>
		        
		        <if test="palletContainerQty!=null">
		        	and pallet_container_qty = #{palletContainerQty}
		        </if>
		        
		        <if test="isStaticLocationAllocate!=null">
		        	and is_static_location_allocate = #{isStaticLocationAllocate}
		        </if>
		        
		        <if test="staticLocationIds!=null and staticLocationIds!=''">
		        	and static_location_ids = #{staticLocationIds}
		        </if>
		        
		        <if test="areaId!=null">
		        	and area_id = #{areaId}
		        </if>
		        
		        <if test="trayIds!=null and trayIds!=''">
		        	and tray_ids = #{trayIds}
		        </if>
		        
		        <if test="packingCaseIds!=null and packingCaseIds!=''">
		        	and packing_case_ids = #{packingCaseIds}
		        </if>
		</where>
	</sql>
	

		<update id="updateByVersion" parameterType="com.baozun.scm.primservice.whoperation.model.odo.wave.WhWaveLine">
		    <![CDATA[
		        UPDATE t_wh_wave_line SET
			        wave_id = #{waveId,javaType=java.lang.Long,jdbcType=BIGINT} ,
			        odo_line_id = #{odoLineId,javaType=java.lang.Long,jdbcType=BIGINT} ,
			        odo_id = #{odoId,javaType=java.lang.Long,jdbcType=BIGINT} ,
			        odo_code = #{odoCode,javaType=java.lang.String,jdbcType=VARCHAR} ,
			        odo_priority_level = #{odoPriorityLevel,javaType=java.lang.Integer,jdbcType=INTEGER} ,
			        odo_plan_deliver_goods_time = #{odoPlanDeliverGoodsTime,javaType=java.util.Date,jdbcType=TIMESTAMP} ,
			        odo_order_time = #{odoOrderTime,javaType=java.util.Date,jdbcType=TIMESTAMP} ,
			        allocate_rule_id = #{allocateRuleId,javaType=java.lang.Long,jdbcType=BIGINT} ,
			        linenum = #{linenum,javaType=java.lang.Integer,jdbcType=INTEGER} ,
			        store_id = #{storeId,javaType=java.lang.Long,jdbcType=BIGINT} ,
			        ext_linenum = #{extLinenum,javaType=java.lang.Integer,jdbcType=INTEGER} ,
			        sku_id = #{skuId,javaType=java.lang.Long,jdbcType=BIGINT} ,
			        sku_bar_code = #{skuBarCode,javaType=java.lang.String,jdbcType=VARCHAR} ,
			        sku_name = #{skuName,javaType=java.lang.String,jdbcType=VARCHAR} ,
			        ext_sku_name = #{extSkuName,javaType=java.lang.String,jdbcType=VARCHAR} ,
			        qty = #{qty,javaType=Double,jdbcType=DECIMAL} ,
			        is_whole_order_outbound = #{isWholeOrderOutbound,javaType=java.lang.Boolean,jdbcType=BIT} ,
			        full_line_outbound = #{fullLineOutbound,javaType=java.lang.Boolean,jdbcType=BIT} ,
			        mfg_date = #{mfgDate,javaType=java.util.Date,jdbcType=TIMESTAMP} ,
			        exp_date = #{expDate,javaType=java.util.Date,jdbcType=TIMESTAMP} ,
			        min_exp_date = #{minExpDate,javaType=java.util.Date,jdbcType=TIMESTAMP} ,
			        max_exp_date = #{maxExpDate,javaType=java.util.Date,jdbcType=TIMESTAMP} ,
			        batch_number = #{batchNumber,javaType=java.lang.String,jdbcType=VARCHAR} ,
			        country_of_origin = #{countryOfOrigin,javaType=java.lang.String,jdbcType=VARCHAR} ,
			        inv_status = #{invStatus,javaType=java.lang.Long,jdbcType=BIGINT} ,
			        inv_type = #{invType,javaType=java.lang.String,jdbcType=VARCHAR} ,
			        inv_attr1 = #{invAttr1,javaType=java.lang.String,jdbcType=VARCHAR} ,
			        inv_attr2 = #{invAttr2,javaType=java.lang.String,jdbcType=VARCHAR} ,
			        inv_attr3 = #{invAttr3,javaType=java.lang.String,jdbcType=VARCHAR} ,
			        inv_attr4 = #{invAttr4,javaType=java.lang.String,jdbcType=VARCHAR} ,
			        inv_attr5 = #{invAttr5,javaType=java.lang.String,jdbcType=VARCHAR} ,
			        outbound_carton_type = #{outboundCartonType,javaType=java.lang.Long,jdbcType=BIGINT} ,
			        color = #{color,javaType=java.lang.String,jdbcType=VARCHAR} ,
			        style = #{style,javaType=java.lang.String,jdbcType=VARCHAR} ,
			        size = #{size,javaType=java.lang.String,jdbcType=VARCHAR} ,
			        create_time = #{createTime,javaType=java.util.Date,jdbcType=TIMESTAMP} ,
			        created_id = #{createdId,javaType=java.lang.Long,jdbcType=BIGINT} ,
			        last_modify_time = now() ,
			        modified_id = #{modifiedId,javaType=java.lang.Long,jdbcType=BIGINT} ,
			        allocate_qty = #{allocateQty,javaType=java.lang.Double,jdbcType=DECIMAL} ,
			        is_pallet_container = #{isPalletContainer,javaType=java.lang.Boolean,jdbcType=BIT} ,
			        pallet_container_qty = #{palletContainerQty,javaType=java.lang.Double,jdbcType=DECIMAL} ,
			        is_static_location_allocate = #{isStaticLocationAllocate,javaType=java.lang.Boolean,jdbcType=BIT} ,
			        static_location_ids = #{staticLocationIds,javaType=java.lang.String,jdbcType=VARCHAR} ,
			        area_id = #{areaId,javaType=java.lang.Long,jdbcType=BIGINT} ,
			        tray_ids = #{trayIds,javaType=java.lang.String,jdbcType=VARCHAR} ,
					packing_case_ids = #{packingCaseIds,javaType=java.lang.String,jdbcType=VARCHAR} 
		        WHERE 
			        id = #{id} 
			        and ou_id = #{ouId} 
			        and last_modify_time	<=  #{lastModifyTime}    
		    ]]>
		</update>
		
		<sql id="waveLineSkuColumn">
	    <![CDATA[
	    		sku.id as skuId,
	    		
	        	waveline.id as waveLineId,
	        	waveline.wave_id as waveLineWaveId,
	        	waveline.odo_line_id as waveLineOdoLineId,
	        	waveline.odo_id as waveLineOdoId,
	        	waveline.odo_code as waveLineOdoCode,
	        	waveline.odo_priority_level as waveLineOdoPriorityLevel,
	        	waveline.odo_plan_deliver_goods_time as waveLineOdoPlanDeliverGoodsTime,
	        	waveline.odo_order_time as waveLineOdoOrderTime,
	        	waveline.allocate_rule_id as waveLineAllocateRuleId,
	        	waveline.linenum as waveLineLinenum,
	        	waveline.store_id as waveLineStoreId,
	        	waveline.ext_linenum as waveLineExtLinenum,
	        	waveline.sku_id as waveLineSkuId,
	        	waveline.sku_bar_code as waveLineSkuBarCode,
	        	waveline.sku_name as waveLineSkuName,
	        	waveline.ext_sku_name as waveLineExtSkuName,
	        	waveline.qty as waveLineQty,
	        	waveline.is_whole_order_outbound as waveLineIsWholeOrderOutbound,
	        	waveline.full_line_outbound as waveLineFullLineOutbound,
	        	waveline.mfg_date as waveLineMfgDate,
	        	waveline.exp_date as waveLineExpDate,
	        	waveline.min_exp_date as waveLineMinExpDate,
	        	waveline.max_exp_date as waveLineMaxExpDate,
	        	waveline.batch_number as waveLineBatchNumber,
	        	waveline.country_of_origin as waveLineCountryOfOrigin,
	        	waveline.inv_status as waveLineInvStatus,
	        	waveline.inv_type as waveLineInvType,
	        	waveline.inv_attr1 as waveLineInvAttr1,
	        	waveline.inv_attr2 as waveLineInvAttr2,
	        	waveline.inv_attr3 as waveLineInvAttr3,
	        	waveline.inv_attr4 as waveLineInvAttr4,
	        	waveline.inv_attr5 as waveLineInvAttr5,
	        	waveline.outbound_carton_type as waveLineOutboundCartonType,
	        	waveline.color as waveLineColor,
	        	waveline.style as waveLineStyle,
	        	waveline.size as waveLineSize,
	        	waveline.ou_id as waveLineOuId,
	        	waveline.create_time as waveLineCreateTime,
	        	waveline.created_id as waveLineCreatedId,
	        	waveline.last_modify_time as waveLineLastModifyTime,
	        	waveline.modified_id as waveLineModifiedId,
	        	
	        	sku.id as skuSkuId,
                sku.code as skuCode,
                sku.bar_code as skuBarCode,
                sku.name as skuName,
                sku.en_name as skuEnName,
                sku.description as skuDescription,
                sku.color as skuColor,
                sku.length as skuLength,
                sku.width as skuWidth,
                sku.height as skuHeight,
                sku.volume as skuVolume,
                sku.weight as skuWeight,
                sku.brand_id as skuBrandId,
                sku.customer_id as skuCustomerId,
                sku.create_time as skuCreateTime,
                sku.created_id as skuCreatedId,
                sku.last_modify_time as skuLastModifyTime,
                sku.modified_id as skuModifiedId, 
                sku.style as skuStyle,
                sku.size as skuSize,
                sku.lifecycle as skuLifecycle,
                sku.ext_code as skuExtCode,
                
                odoLine.id as odoLineId,
	        	odoLine.odo_id as odoLineOdoId,
	        	odoLine.linenum as odoLineLinenum,
	        	odoLine.original_linenum as odoLineOriginalLinenum,
	        	odoLine.store_id as odoLineStoreId,
	        	odoLine.ext_linenum as odoLineExtLinenum,
	        	odoLine.sku_id as odoLineSkuId,
	        	odoLine.sku_bar_code as odoLineSkuBarCode,
	        	odoLine.sku_name as odoLineSkuName,
	        	odoLine.ext_sku_name as odoLineExtSkuName,
	        	odoLine.qty as odoLineQty,
	        	odoLine.plan_qty as odoLinePlanQty,
	        	odoLine.current_qty as odoLineCurrentQty,
	        	odoLine.actual_qty as odoLineActualQty,
	        	odoLine.cancel_qty as odoLineCancelQty,
	        	odoLine.assign_qty as odoLineAssignQty,
	        	odoLine.dieking_qty as odoLineDiekingQty,
	        	odoLine.line_price as odoLineLinePrice,
	        	odoLine.line_amt as odoLineLineAmt,
	        	odoLine.odo_line_status as odoLineOdoLineStatus,
	        	odoLine.is_check as odoLineIsCheck,
	        	odoLine.full_line_outbound as odoLineFullLineOutbound,
	        	odoLine.part_outbound_strategy as odoLinePartOutboundStrategy,
	        	odoLine.mfg_date as odoLineMfgDate,
	        	odoLine.exp_date as odoLineExpDate,
	        	odoLine.min_exp_date as odoLineMinExpDate,
	        	odoLine.max_exp_date as odoLineMaxExpDate,
	        	odoLine.batch_number as odoLineBatchNumber,
	        	odoLine.country_of_origin as odoLineCountryOfOrigin,
	        	odoLine.inv_status as odoLineInvStatus,
	        	odoLine.inv_type as odoLineInvType,
	        	odoLine.inv_attr1 as odoLineInvAttr1,
	        	odoLine.inv_attr2 as odoLineInvAttr2,
	        	odoLine.inv_attr3 as odoLineInvAttr3,
	        	odoLine.inv_attr4 as odoLineInvAttr4,
	        	odoLine.inv_attr5 as odoLineInvAttr5,
	        	odoLine.outbound_carton_type as odoLineOutboundCartonType,
	        	odoLine.color as odoLineColor,
	        	odoLine.style as odoLineStyle,
	        	odoLine.size as odoLineSize,
	        	odoLine.mixing_attr as odoLineMixingAttr,
	        	odoLine.original_odo_code as odoLineOriginalOdoCode,
	        	odoLine.assign_fail_reason as odoLineAssignFailReason,
	        	odoLine.is_assign_success as odoLineIsAssignSuccess,
	        	odoLine.ou_id as odoLineOuId,
	        	odoLine.create_time as odoLineCreateTime,
	        	odoLine.created_id as odoLineCreatedId,
	        	odoLine.last_modify_time as odoLineLastModifyTime,
	        	odoLine.modified_id as odoLineModifiedId,
	        	odoLine.wave_code as odoLineWaveCode
	    ]]>
	</sql>
	
	<select id="findWaveLineCommandByWaveIdAndStatus" resultMap="WaveLineSku">
		select
		<include refid="waveLineSkuColumn" />
		from t_wh_wave wave,t_wh_wave_line waveLine,t_wh_sku sku, t_wh_odo_line odoLine
		where
		waveLine.wave_id=wave.id
		and waveLine.sku_id = sku.id
		and waveLine.ou_id=wave.ou_id
		and waveLine.odo_line_id = odoLine.id
		and wave.lifecycle = #{lifecycle}
		and wave.id = #{waveId}
		and wave.ou_id = #{ouId}
		order by
		waveLine.odo_priority_level,waveLine.odo_plan_deliver_goods_time,
		waveLine.odo_order_time desc,waveLine.qty, waveLine.odo_id asc
	</select>
	
	<delete id="removeWaveLineWhole" parameterType="map">
	    <![CDATA[
	        delete from t_wh_wave_line where
		        wave_id = #{waveId} 
				and odo_id = #{odoId}
				and ou_id = #{ouId}
	    ]]>
	</delete> 
	
	<delete id="removeWaveLineWholeByOdoIdList" parameterType="map">
        delete from t_wh_wave_line where
	        wave_id = #{waveId} 
			and odo_id in 
			<foreach collection="odoIdList" item="id" open="(" separator="," close=")">
				#{id}
			</foreach> 
			and ou_id = #{ouId}
	</delete> 
	    
	<update id="modifyRuleIntoWhWaveLine" parameterType="map">
		update t_wh_wave_line l set l.allocate_rule_id = #{ruleId} 
		<where>
			and l.odo_line_id in 
			<foreach collection="whWaveLine" item="id" open="(" separator="," close=")">
				#{id}
			</foreach> 
			and ou_id = #{ouId}
		</where>
	</update>
	
	<select id="getOdoLinesByWaveIdList" parameterType="map" resultType="long">
		select 
			l.odo_line_id 
		from 
			t_wh_wave_line l 
			left join t_wh_odo o on (o.id = l.odo_id)
		where 
			l.wave_id in 
			<foreach collection="waveIdList" item="id" open="(" separator="," close=")">
				#{id} 
			</foreach> 
			AND l.allocate_rule_id is null
			AND o.odo_status != '88'
			AND l.ou_id = #{ouId}
	</select>
	
	<select id="getWhWaveLinesByWaveIdList" parameterType="map" resultMap="WhWaveLineResultExt">
		select 
			id as id,
        	wave_id as waveId,
        	odo_line_id as odoLineId,
        	odo_id as odoId,
        	odo_code as odoCode,
        	allocate_rule_id as allocateRuleId,
        	store_id as storeId,
        	sku_id as skuId,
        	qty as qty,
        	allocate_qty as allocateQty,
        	is_whole_order_outbound as isWholeOrderOutbound,
        	full_line_outbound as fullLineOutbound,
        	mfg_date as mfgDate,
        	exp_date as expDate,
        	min_exp_date as minExpDate,
        	max_exp_date as maxExpDate,
        	batch_number as batchNumber,
        	country_of_origin as countryOfOrigin,
        	inv_status as invStatus,
        	inv_type as invType,
        	inv_attr1 as invAttr1,
        	inv_attr2 as invAttr2,
        	inv_attr3 as invAttr3,
        	inv_attr4 as invAttr4,
        	inv_attr5 as invAttr5,
        	ou_id as ouId
		from 
			t_wh_wave_line l 
		where 
			l.wave_id in 
			<foreach collection="waveIdList" item="id" open="(" separator="," close=")">
				#{id} 
			</foreach> 
			AND l.ou_id = #{ouId}
	</select>
	
	<select id="getWhWaveLinesByWaveId" parameterType="map" resultMap="WhWaveLineResultExt">
		select 
			l.id as id,
        	l.wave_id as waveId,
        	l.odo_line_id as odoLineId,
        	l.odo_id as odoId,
        	l.odo_code as odoCode,
        	l.allocate_rule_id as allocateRuleId,
        	l.store_id as storeId,
        	l.sku_id as skuId,
        	l.qty as qty,
        	l.allocate_qty as allocateQty,
        	l.is_whole_order_outbound as isWholeOrderOutbound,
        	l.full_line_outbound as fullLineOutbound,
        	l.mfg_date as mfgDate,
        	l.exp_date as expDate,
        	l.min_exp_date as minExpDate,
        	l.max_exp_date as maxExpDate,
        	l.batch_number as batchNumber,
        	l.country_of_origin as countryOfOrigin,
        	l.inv_status as invStatus,
        	l.inv_type as invType,
        	l.inv_attr1 as invAttr1,
			l.inv_attr2 as invAttr2,
        	l.inv_attr3 as invAttr3,
        	l.inv_attr4 as invAttr4,
        	l.inv_attr5 as invAttr5,
        	l.ou_id as ouId
		from 
			t_wh_wave_line l 
			left join t_wh_odo o on (l.odo_id = o.id)
		where 
			l.wave_id = #{waveId}
			AND o.head_start_odo_status != '88'
			AND l.ou_id = #{ouId}
	</select>

    <select id="getWhWaveLineCommandByWaveId" resultMap="WhWaveLineCommand">
        select
        <include refid="whWaveLineColumns" />
        from
        t_wh_wave_line l
        where
        l.wave_id = #{waveId}
        AND l.ou_id = #{ouId}
    </select>

	    
	<select id="findHighestPriorityByOdoIds" resultMap="WhWaveLineResult">
    	select <include refid="whWaveLineColumns" />
	    from t_wh_wave_line 
		where wave_id = #{waveId}
		and odo_id in (#{odoIds})
		and ou_id = #{ouId}
		order by odo_priority_level desc limit 1
		
    </select>
	
	<select id="findWhWaveLineById" parameterType="map" resultMap="WhWaveLineResultExt">
		select 
			<include refid="whWaveLineColumns" />
	    from 
	    	t_wh_wave_line 
	    where 
	        id = #{id} 
        <if test="ouId != null">
        	and ou_id = #{ouId}
        </if>
	</select>
	
	<select id="findNotEnoughAllocationQty" parameterType="map" resultMap="WhWaveLineResultExt">
		select 
			id as id,
        	wave_id as waveId,
        	odo_line_id as odoLineId,
        	odo_id as odoId,
        	sku_id as skuId,
        	odo_code as odoCode,
        	allocate_rule_id as allocateRuleId,
        	qty as qty,
        	allocate_qty as allocateQty,
        	is_whole_order_outbound as isWholeOrderOutbound,
        	full_line_outbound as fullLineOutbound,
        	area_id as areaId,
        	is_static_location_allocate as isStaticLocationAllocate,
        	store_id as storeId,
        	inv_status as invStatus,
        	ou_id as ouId
		from 
			t_wh_wave_line l 
		where 
			l.allocate_qty &lt; l.qty 
			and l.wave_id = #{waveId}
			and ou_id = #{ouId}
		order by 
			l.is_static_location_allocate desc,l.sku_id
	</select>
	
	<select id="countNotEnoughAllocationQty" parameterType="map" resultType="long">
		select 
			count(1)
		from 
			t_wh_wave_line l 
		where 
			l.allocate_qty &lt; l.qty 
			and l.wave_id = #{waveId}
			and ou_id = #{ouId}
	</select>
	
	<select id="findOdoIdByWaveId" resultType="long">
		select distinct odo_id from t_wh_wave_line l
		where l.wave_id = #{waveId}
		and l.ou_id = #{ouId}
	</select>
	
	<select id="findSkuIdByNotEnoughAllocationQty" resultType="long">
		select 
			l.sku_id
		from 
			t_wh_wave_line l 
		where 
			l.allocate_qty &lt; l.qty 
			and l.wave_id = #{waveId}
			and ou_id = #{ouId}
		group by 
			l.sku_id
	</select>

	<select id="findWaveLineByOdoLineIdAndWaveId" resultMap="WhWaveLineResultExt">
		select 
			<include refid="whWaveLineColumns" />
		from 
			t_wh_wave_line
		where 
			wave_id = #{waveId} and odo_line_id = #{odoLineId} and ou_id = #{ouId}
	</select>
	
	<sql id="whWaveLineColumnsExt1">
	    <![CDATA[
        	waveLine.id as id,
        	waveLine.wave_id as waveId,
        	waveLine.odo_line_id as odoLineId,
        	waveLine.odo_id as odoId,
        	waveLine.odo_code as odoCode,
        	waveLine.odo_priority_level as odoPriorityLevel,
        	waveLine.odo_plan_deliver_goods_time as odoPlanDeliverGoodsTime,
        	waveLine.odo_order_time as odoOrderTime,
        	waveLine.allocate_rule_id as allocateRuleId,
        	waveLine.linenum as linenum,
        	waveLine.store_id as storeId,
        	waveLine.ext_linenum as extLinenum,
        	waveLine.sku_id as skuId,
        	waveLine.sku_bar_code as skuBarCode,
        	waveLine.sku_name as skuName,
        	waveLine.ext_sku_name as extSkuName,
        	waveLine.qty as qty,
        	waveLine.allocate_qty as allocateQty,
        	waveLine.is_whole_order_outbound as isWholeOrderOutbound,
        	waveLine.full_line_outbound as fullLineOutbound,
        	waveLine.mfg_date as mfgDate,
        	waveLine.exp_date as expDate,
        	waveLine.min_exp_date as minExpDate,
        	waveLine.max_exp_date as maxExpDate,
        	waveLine.batch_number as batchNumber,
        	waveLine.country_of_origin as countryOfOrigin,
        	waveLine.inv_status as invStatus,
        	waveLine.inv_type as invType,
        	waveLine.inv_attr1 as invAttr1,
        	waveLine.inv_attr2 as invAttr2,
        	waveLine.inv_attr3 as invAttr3,
        	waveLine.inv_attr4 as invAttr4,
        	waveLine.inv_attr5 as invAttr5,
        	waveLine.outbound_carton_type as outboundCartonType,
        	waveLine.color as color,
        	waveLine.style as style,
        	waveLine.size as size,
        	waveLine.ou_id as ouId,
        	waveLine.create_time as createTime,
        	waveLine.created_id as createdId,
        	waveLine.last_modify_time as lastModifyTime,
        	waveLine.modified_id as modifiedId, 
        	waveLine.is_pallet_container as isPalletContainer,
        	waveLine.pallet_container_qty as palleContainerQty, 
        	waveLine.is_static_location_allocate as isStaticLocationAllocate,
        	waveLine.static_location_ids as staticLocationIds,
        	waveLine.area_id as areaId,
			waveLine.tray_ids as trayIds,
			waveLine.packing_case_ids as packingCaseIds
	    ]]>
	</sql>
	
	<select id="findSoftAllocationWhWaveLine" resultMap="WhWaveLineResultExt">
		select
		<include refid="whWaveLineColumnsExt1" />
		from t_wh_wave wave,t_wh_wave_line waveLine
		where
		waveLine.wave_id=wave.id
		and waveLine.ou_id=wave.ou_id
		and wave.lifecycle = #{lifecycle}
		and wave.id = #{waveId}
		and wave.ou_id = #{ouId}
		order by
		waveLine.odo_priority_level asc,waveLine.odo_plan_deliver_goods_time asc,waveLine.qty desc,
		waveLine.odo_order_time asc, waveLine.odo_id asc
	</select>
	
	
	<select id="findListByQueryMapWithPageExt" resultMap="WhWaveLineCommandResultExt">
    	select <include refid="whWaveLineColumns" />
	    from t_wh_wave_line 
		<include refid="whWaveLineDynamicWhereExt"/>
		
    </select>
    
   <select id="findListCountByQueryMapExt" resultType="long">
        select count(*) from t_wh_wave_line
       <include refid="whWaveLineDynamicWhereExt"/>
       order by odo_code 
    </select>
		<delete id="deleteByIdOuId" parameterType="map">
	    <![CDATA[
	        delete from t_wh_wave_line where
		        id = #{id} and ou_id=#{ouId}
	    ]]>
	    </delete> 
	    
	    
	    
	    <insert id="batchInsert" parameterType="map" 
				
			 flushCache="true">
		    <![CDATA[
		        INSERT INTO
		        t_wh_wave_line (
		        id,
		        	wave_id ,
		        	odo_line_id ,
		        	odo_id ,
		        	odo_code ,
		        	odo_priority_level ,
		        	odo_plan_deliver_goods_time ,
		        	odo_order_time ,
		        	allocate_rule_id ,
		        	linenum ,
		        	store_id ,
		        	ext_linenum ,
		        	sku_id ,
		        	sku_bar_code ,
		        	sku_name ,
		        	ext_sku_name ,
		        	qty ,
		        	is_whole_order_outbound ,
		        	full_line_outbound ,
		        	mfg_date ,
		        	exp_date ,
		        	min_exp_date ,
		        	max_exp_date ,
		        	batch_number ,
		        	country_of_origin ,
		        	inv_status ,
		        	inv_type ,
		        	inv_attr1 ,
		        	inv_attr2 ,
		        	inv_attr3 ,
		        	inv_attr4 ,
		        	inv_attr5 ,
		        	outbound_carton_type ,
		        	color ,
		        	style ,
		        	size ,
		        	ou_id ,
		        	create_time ,
		        	created_id ,
		        	last_modify_time ,
		        	modified_id ,
		        	is_static_location_allocate,
		        	allocate_qty
		        ) VALUES 
		    ]]>
		    	<foreach collection="list" item="item" index="index"
			separator=",">
		    (
		        #{item.id,javaType=java.lang.Long,jdbcType=BIGINT} ,
		        	#{item.waveId,javaType=java.lang.Long,jdbcType=BIGINT} ,
		        	#{item.odoLineId,javaType=java.lang.Long,jdbcType=BIGINT} ,
		        	#{item.odoId,javaType=java.lang.Long,jdbcType=BIGINT} ,
		        	#{item.odoCode,javaType=java.lang.String,jdbcType=VARCHAR} ,
		        	#{item.odoPriorityLevel,javaType=java.lang.Integer,jdbcType=INTEGER} ,
		        	#{item.odoPlanDeliverGoodsTime,javaType=java.util.Date,jdbcType=TIMESTAMP} ,
		        	#{item.odoOrderTime,javaType=java.util.Date,jdbcType=TIMESTAMP} ,
		        	#{item.allocateRuleId,javaType=java.lang.Long,jdbcType=BIGINT} ,
		        	#{item.linenum,javaType=java.lang.Integer,jdbcType=INTEGER} ,
		        	#{item.storeId,javaType=java.lang.Long,jdbcType=BIGINT} ,
		        	#{item.extLinenum,javaType=java.lang.Integer,jdbcType=INTEGER} ,
		        	#{item.skuId,javaType=java.lang.Long,jdbcType=BIGINT} ,
		        	#{item.skuBarCode,javaType=java.lang.String,jdbcType=VARCHAR} ,
		        	#{item.skuName,javaType=java.lang.String,jdbcType=VARCHAR} ,
		        	#{item.extSkuName,javaType=java.lang.String,jdbcType=VARCHAR} ,
		        	#{item.qty,javaType=Double,jdbcType=DECIMAL} ,
		        	#{item.isWholeOrderOutbound,javaType=java.lang.Boolean,jdbcType=BIT} ,
		        	#{item.fullLineOutbound,javaType=java.lang.Boolean,jdbcType=BIT} ,
		        	#{item.mfgDate,javaType=java.util.Date,jdbcType=TIMESTAMP} ,
		        	#{item.expDate,javaType=java.util.Date,jdbcType=TIMESTAMP} ,
		        	#{item.minExpDate,javaType=java.util.Date,jdbcType=TIMESTAMP} ,
		        	#{item.maxExpDate,javaType=java.util.Date,jdbcType=TIMESTAMP} ,
		        	#{item.batchNumber,javaType=java.lang.String,jdbcType=VARCHAR} ,
		        	#{item.countryOfOrigin,javaType=java.lang.String,jdbcType=VARCHAR} ,
		        	#{item.invStatus,javaType=java.lang.Long,jdbcType=BIGINT} ,
		        	#{item.invType,javaType=java.lang.String,jdbcType=VARCHAR} ,
		        	#{item.invAttr1,javaType=java.lang.String,jdbcType=VARCHAR} ,
		        	#{item.invAttr2,javaType=java.lang.String,jdbcType=VARCHAR} ,
		        	#{item.invAttr3,javaType=java.lang.String,jdbcType=VARCHAR} ,
		        	#{item.invAttr4,javaType=java.lang.String,jdbcType=VARCHAR} ,
		        	#{item.invAttr5,javaType=java.lang.String,jdbcType=VARCHAR} ,
		        	#{item.outboundCartonType,javaType=java.lang.Long,jdbcType=BIGINT} ,
		        	#{item.color,javaType=java.lang.String,jdbcType=VARCHAR} ,
		        	#{item.style,javaType=java.lang.String,jdbcType=VARCHAR} ,
		        	#{item.size,javaType=java.lang.String,jdbcType=VARCHAR} ,
		        	#{item.ouId,javaType=java.lang.Long,jdbcType=BIGINT} ,
		        	#{item.createTime,javaType=java.util.Date,jdbcType=TIMESTAMP} ,
		        	#{item.createdId,javaType=java.lang.Long,jdbcType=BIGINT} ,
		        	#{item.lastModifyTime,javaType=java.util.Date,jdbcType=TIMESTAMP} ,
		        	#{item.modifiedId,javaType=java.lang.Long,jdbcType=BIGINT} ,
		        	#{item.isStaticLocationAllocate,javaType=java.lang.Boolean,jdbcType=BIT} ,
		        	#{item.allocateQty,javaType=java.lang.Double,jdbcType=DECIMAL} 
		        
		        )
				</foreach>
		</insert>
	

    <select id="getOdoIdListByWaveIdList" resultType="Long">
        select
            distinct odo_id
        from
            t_wh_wave_line
        where
            wave_id in
        <foreach collection="waveIdList" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
        AND ou_id = #{ouId}
    </select>

    <select id="getOdoIdListByWaveId" resultType="Long">
        select
            distinct odo_id
        from t_wh_wave_line
        where
            wave_id = #{waveId}
            AND ou_id = #{ouId}
    </select>

</mapper>
